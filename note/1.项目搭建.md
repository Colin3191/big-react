# 项目搭建


## pnpm初始化

```shell 
npm install -g pnpm
pnpm init
```


## 定义开发规范

代码规范：lint工具  
eslint
安装：
```shell
pnpm i eslint -D -w
```

初始化：
```shell
npx eslint --init
```
.eslintrc.json配置如下：
```json
{
   "env": {
    "browser": true,
    "es2021": true,
    "node": true
   },
   "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier",
    "plugin:prettier/recommended"
   ],
   "parser": "@typescript-eslint/parser",
   "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module"
   },
   "plugins": ["@typescript-eslint", "prettier"],
   "rules": {
    "prettier/prettier": "error",
    "no-case-declarations": "off",
    "no-constant-condition": "off",
    "@typescript-eslint/ban-ts-comment": "off"
   }
}
```

安装ts的eslint插件：
```shell
pnpm i -D -w @typescript-eslint/eslint-plugin
```

代码风格：prettier  
安装：
```shell
pnpm i prettier -D -w
```

新建.prettierrc.json配置文件，添加配置：
```json
{
 "printWidth": 80,
 "tabWidth": 2,
 "useTabs": true,
 "singleQuote": true,
 "semi": true,
 "trailingComma": "none",
 "bracketSpacing": true
}
```

将prettier集成到eslint中，其中：

* eslint-config-prettier：覆盖ESLint本身的规则配置

* eslint-plugin-prettier：用Prettier来接管修复代码即eslint --fix
  
```shell
pnpm i eslint-config-prettier eslint-plugin-prettier -D -w
```

为lint增加对应的执行脚本，并验证效果：
```json
"lint": "eslint --ext .ts,.jsx,.tsx --fix --quiet ./packages"
```


## commit规范检查

安装husky，用于拦截commit命令：
```shell
pnpm i husky -D -w
```

初始化husky：
```shell
npx husky install
```

将刚才实现的格式化命令pnpm lint纳入commit时husky将执行的脚本：
```shell
npx husky add .husky/pre-commit "pnpm lint"
```

通过commitlint对git提交信息进行检查，首先安装必要的库：
```shell
pnpm i commitlint @commitlint/cli @commitlint/config-conventional -D -w
```

新建配置文件.commitlintrc.js：
```js
module.exports = {
  extends: ["@commitlint/config-conventional"]
};
```

集成到husky中：
```shell
npx husky add .husky/commit-msg "npx --no-install commitlint -e $HUSKY_GIT_PARAMS"
```

conventional规范集意义：
```
// 提交的类型: 摘要信息
<type>: <subject>
```

常用的type值包括如下:

* feat: 添加新功能
* fix: 修复 Bug
* chore: 一些不影响功能的更改
* docs: 专指文档的修改
* perf: 性能方面的优化
* refactor: 代码重构
* test: 添加一些测试代码等等

配置tsconfig.json：
```json
{
 "compileOnSave": true,
 "compilerOptions": {
  "target": "ESNext",
  "useDefineForClassFields": true,
  "module": "ESNext",
  "lib": ["ESNext", "DOM"],
  "moduleResolution": "Node",
  "strict": true,
  "sourceMap": true,
  "resolveJsonModule": true,
  "isolatedModules": true,
  "esModuleInterop": true,
  "noEmit": true,
  "noUnusedLocals": true,
  "noUnusedParameters": true,
  "noImplicitReturns": false,
  "skipLibCheck": true,
  "baseUrl": "./packages"
 }
}
```

